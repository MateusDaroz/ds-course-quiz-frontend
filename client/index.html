<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz - Desenvolvimento de Sistemas</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.1/font/bootstrap-icons.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-purple: #663399;
            --secondary-purple: #4B0082;
            --dark-bg: #020403;
            --dark-card: #26282A;
            --light-text: #cbcbcb;
            --gradient-border: linear-gradient(to right, #663399, #4B0082);
            --gradient-bg: linear-gradient(135deg, #020403 20%, #212122);
            /* Vintage TV colors */
            --tv-bezel: #644E3D; /* Light gray-beige plastic */
            --tv-shadow: #A5876E; /* Darker gray for shadows */
            --tv-screen-bg: #000; /* Black screen */
        }

        body {
            background: var(--gradient-bg);
            min-height: 100vh;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
        }

        h1, h2, h3, p{
            color: white !important;
        }

        h4, h5, h6{
            color: #cdcdcd !important;
        }

        /* Home Screen Styles - Vintage TV Design */
        .home-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: radial-gradient(circle at center, #1a1a1a 0%, #0a0a0a 100%); /* Dark room-like background */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: all 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .home-screen.fade-out {
            opacity: 0;
            transform: scale(1.2);
            pointer-events: none;
        }

        .tv-frame {
            position: relative;
            width: clamp(400px, 60vw, 700px); /* More rectangular, responsive */
            height: clamp(300px, 45vw, 525px); /* 4:3 aspect ratio approx */
            background: linear-gradient(145deg, var(--tv-bezel), var(--tv-shadow)); /* Beige-gray plastic gradient */
            border: 8px solid var(--tv-shadow); /* Outer plastic border */
            border-radius: 12px; /* Slight rounding like vintage TVs */
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.6), /* Floor shadow */
                inset 0 4px 8px rgba(255, 255, 255, 0.1), /* Inner highlight */
                inset 0 -4px 8px rgba(0, 0, 0, 0.2); /* Inner shadow */
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px; /* Inner padding for bezel */
        }

        /* TV Bezel and Controls */
        .tv-bezel {
            position: relative;
            width: 100%;
            height: 100%;
            background: var(--tv-bezel);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            flex-direction: row;
        }

        .tv-screen {
            flex: 1;
            background: var(--tv-screen-bg);
            border: 4px inset var(--tv-shadow); /* Inset border for screen depth */
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 10px; /* Space from bezel */
            animation: tvGlow 3s ease-in-out infinite alternate;
        }

        .tv-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(75,0,130,.4) 2px, /* Faint scanlines */
                    rgba(75,0,130,.4) 4px
                );
            animation: scanlines 0.2s linear infinite; /* Faster scanlines for vintage feel */
            pointer-events: none;
        }

        .tv-controls {
            /*position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            ]
            */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-evenly;
            background-color: #644E3D;
            z-index: 10;
            
        }

        .knob {
            margin-right: 10px;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle at 30% 30%, #C0C0C0, #A0A0A0); /* Knobs gradient */
            border: 2px outset var(--tv-shadow); /* Outset for 3D knob effect */
            border-radius: 50%;
            position: relative;
            box-shadow: 
                0 2px 4px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.2);
        }

        .knob::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: #808080;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .knob::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            width: 4px;
            height: 20px;
            background: #606060;
            border-radius: 2px;
        }

        .controls-labels {
            position: absolute;
            right: 15px;
            bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            font-size: 0.7rem;
            color: #333;
            font-weight: bold;
            text-align: right;
        }

        .controls-labels div {
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.6rem;
        }

        @keyframes tvGlow {
            0% { box-shadow: inset 0 0 20px rgba(255,255,255,0.05); }
            100% { box-shadow: inset 0 0 40px rgba(255,255,255,0.1); }
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }

        .home-title {
            font-size: clamp(2.5rem, 6vw, 5rem);
            font-weight: 900;
            text-align: center;
            margin-bottom: 2rem;
            color: rgb(116, 82, 150) !important; /* Off-white for vintage CRT glow */
            text-shadow: 
                0 0 10px rgba(102,51,153,0.8),
                0 0 20px rgba(102,51,153,0.4); /* CRT glow effect */
            animation: titlePulse 2s ease-in-out infinite alternate;
            position: relative;
            z-index: 10;
            font-family: 'Courier New', monospace; /* Vintage font */
            letter-spacing: 2px;
        }

        @keyframes titlePulse {
            0% { transform: scale(1); opacity: 0.9; }
            100% { transform: scale(1.02); opacity: 1; }
        }

        .home-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
            z-index: 10;
            position: relative;
        }

        .home-btn {
            background: var(--gradient-border); /* Dark gray buttons for vintage */
            border: 2px outset #4B0082; /* Outset border for button depth */
            color: #E0E0E0;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            min-width: 180px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(255, 255, 255, 0.15);
        }

        .home-btn:hover {
            transform: translateY(-2px);
            background: var(--gradient-border);
            border-color: #4B0082;
            box-shadow: 0 6px 12px rgba(255, 255, 255, 0.2);
            color: #FFF;
        }

        .home-btn:active {
            border-style: inset;
            transform: translateY(0);
        }

        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 40px 40px;
            opacity: 0.5;
            pointer-events: none;
        }

        /* TV Animation for transition */
        .tv-transition {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 80px;
            background: #000;
            border-radius: 10px;
            transform: translate(-50%, -50%) scale(0);
            z-index: 3000;
            animation: tvZoomIn 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes tvZoomIn {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(100);
                opacity: 0;
            }
        }

        .custom-card {
            background: var(--dark-card);
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .gradient-border {
            padding: 3px;
            background: var(--gradient-border);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .gradient-border .card {
            background: var(--dark-card);
            border: none;
            border-radius: 17px;
        }

        .btn-purple {
            background: var(--gradient-border);
            border: none;
            color: white;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-purple:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 51, 153, 0.4);
            color: white;
        }

        .btn-purple:disabled {
            background: #6c757d;
            transform: none;
            box-shadow: none;
        }

        .form-control {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            border-radius: 10px;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 0.2rem rgba(102, 51, 153, 0.25);
            color: white;
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-floating label, .form-floating>.form-control:focus~label{
            color: grey;
        }

        .form-floating>.form-control-plaintext~label::after, .form-floating>.form-control:focus~label::after, .form-floating>.form-control:not(:placeholder-shown)~label::after, .form-floating>.form-select~label::after{
            background: none;
        }

        .form-floating>.form-control:not(:placeholder-shown)~label{
            color: white
        }

        .question-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .alternative-btn {
            background-color: #2b2d2f;
            border: 3px solid transparent;
            border-radius: 10px;
            color: white;
            transition: all 0.3s ease;
            text-align: left;
            min-height: 60px;
            display: flex;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn:first-child:active{
            color: white;
        }
    
        .alternative-btn:hover {
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .alternative-btn.correct {
            border-color: #28a745;
            color: #28a745;
        }

        .alternative-btn.wrong {
            border-color: #dc3545;
            color: #dc3545;
        }

        .alternative-btn.show-correct {
            border-color: #28a745;
            color: #28a745;
        }

        .player-item {
            background: linear-gradient(145deg, #02040250, #21212250) !important;
            border: 1px solid rgba(102, 51, 153, 0.3);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .player-item:hover {
            border-color: var(--primary-purple);
            box-shadow: 0 5px 15px rgba(102, 51, 153, 0.2);
        }

        .player-header {
            background: var(--gradient-border);
            border-radius: 10px;
            color: white;
            font-weight: 600;
        }

        .leaderboard-item {
            color: white !important;
            background: #2b2d2f;
            border: 1px solid rgba(0,0,0,0.1);
            border-radius: 10px;
            color: #333;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .leaderboard-item.top {
            background: linear-gradient(145deg, #ffd700, #ffed4e);
            border-color: #ffc107;
            color: #856404 !important;
            font-weight: bold;
        }

        .timer {
            background: linear-gradient(145deg, #dc3545, #c82333);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            font-size: 2rem;
        }

        .score {
            color: #28a745;
            font-weight: bold;
            font-size: 1.25rem;
        }

        .waiting {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .badge-purple {
            background: var(--gradient-border);
            color: white;
        }

        .text-purple {
            color: var(--primary-purple);
        }

        .progress {
            background: rgba(255, 255, 255, 0.2);
            height: 8px;
        }

        .progress-bar {
            background: var(--gradient-border);
        }

        .icon-lg {
            font-size: 3rem;
            color: var(--primary-purple);
        }

        .custom-scrollbar {
            max-height: 400px;
            overflow-y: auto;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--gradient-border);
            border-radius: 10px;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .connection-status {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            font-size: 0.8rem;
        }

        .main-content {
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .main-content.show {
            opacity: 1;
            transform: scale(1);
        }

        @media (max-width: 768px) {
            .alternatives-grid {
                grid-template-columns: 1fr !important;
            }
            
            .timer {
                font-size: 1.5rem;
            }

            .tv-frame {
                width: 90vw;
                height: 68vw; /* Maintain aspect on mobile */
                padding: 15px;
            }

            .home-title {
                font-size: clamp(2rem, 8vw, 3.5rem);
                letter-spacing: 1px;
            }

            .home-btn {
                min-width: 160px;
                padding: 10px 25px;
                font-size: 1rem;
            }

            .tv-controls {
                right: 10px;
                gap: 20px;
            }

            .knob {
                width: 32px;
                height: 32px;
            }

            .controls-labels {
                right: 10px;
                bottom: 10px;
                font-size: 0.5rem;
            }

            .controls-labels div {
                padding: 1px 4px;
                font-size: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Home Screen - Vintage TV -->
    <div id="homeScreen" class="home-screen">
        <div class="tv-frame">
            <div class="tv-bezel">
                <div class="tv-screen">
                    <div class="grid-overlay"></div>
                    <h1 class="home-title">DS QUIZ</h1>
                    <div class="home-buttons">
                        <button class="home-btn" onclick="startQuiz()">
                            <i class="bi bi-play-circle-fill me-2"></i>Começar
                        </button>
                        <button class="home-btn" onclick="showCredits()">
                            <i class="bi bi-info-circle-fill me-2"></i>Créditos
                        </button>
                    </div>
                </div>
                <!-- Vintage TV Controls -->
                <div class="tv-controls">
                    <div class="knob"></div>
                    <div class="knob"></div>
                    <div class="knob"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connection Status Indicator -->
    <div class="connection-status">
        <span id="connectionStatus" class="badge bg-secondary">Connecting...</span>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content container-fluid py-4 d-flex align-items-center justify-content-center min-vh-100">
        <div class="row justify-content-center w-100">
            <div class="col-12 col-md-10 col-lg-8 col-xl-6">
                <div class="gradient-border">
                    <div class="card custom-card">
                        <div class="card-body p-4 p-md-5">
                            
                            <!-- System Selection -->
                            <div id="systemSelector" class="text-center">
                                <div class="mb-4">
                                    <i class="bi bi-code-slash icon-lg mb-3"></i>
                                    <h1 class="display-5 fw-bold mb-3">Quiz - Desenvolvimento de Sistemas</h1>
                                    <h5 class="mb-4">Teste seus conhecimentos sobre o melhor curso do COTIL!</h5>
                                </div>
                                <div class="d-grid gap-3 d-md-flex justify-content-md-center">
                                    <button class="btn btn-purple btn-lg px-4" onclick="initHost()">
                                        <i class="bi bi-person-gear me-2"></i>Sistema do Organizador
                                    </button>
                                    <button class="btn btn-purple btn-lg px-4" onclick="initPlayer()">
                                        <i class="bi bi-person-plus me-2"></i>Sistema do Jogador
                                    </button>
                                </div>
                                <div class="mt-4">
                                    <button class="btn btn-outline-light" onclick="goBackHome()">
                                        <i class="bi bi-arrow-left me-2"></i>Voltar ao Início
                                    </button>
                                </div>
                            </div>

                            <!-- Player System -->
                            <div id="playerSystem" class="d-none">
                                <!-- Player Registration -->
                                <div id="playerRegistration">
                                    <div class="text-center mb-4">
                                        <i class="bi bi-door-open icon-lg mb-3"></i>
                                        <h2 class="mb-4">Entre na sala de espera!</h2>
                                    </div>
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <div class="form-floating">
                                                <input type="text" class="form-control" id="playerName" placeholder="Digite seu nome" required>
                                                <label for="playerName"><i class="bi bi-person me-2"></i>Seu nome</label>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-floating">
                                                <input type="text" class="form-control" id="playerSchool" placeholder="Digite o nome da sua escola" required>
                                                <label for="playerSchool"><i class="bi bi-building me-2"></i>Nome da sua escola</label>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-floating">
                                                <input type="text" class="form-control" id="playerCity" placeholder="Digite o nome da sua cidade" required>
                                                <label for="playerCity"><i class="bi bi-geo-alt me-2"></i>Nome da sua cidade</label>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-4">
                                            <button class="btn btn-purple w-100 btn-lg" onclick="joinGame()">
                                                <i class="bi bi-arrow-right-circle me-2"></i>Entrar na sala de espera
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Player Waiting -->
                                <div id="playerWaiting" class="d-none">
                                    <div class="text-center waiting">
                                        <i class="bi bi-hourglass-split icon-lg mb-3"></i>
                                        <h2 class="mb-4">Esperando o jogo começar...</h2>
                                        <div class="spinner-border text-light mb-3" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p>Espere todos os jogadores entrarem!</p>
                                    </div>
                                </div>

                                <!-- Player Quiz -->
                                <div id="playerQuiz" class="d-none">
                                    <div class="d-flex justify-content-between align-items-center mb-4">
                                        <div class="score" id="playerScore">
                                            <i class="bi bi-trophy me-2"></i>Pontuação: 0 pontos
                                        </div>
                                        <div class="badge badge-purple fs-6">
                                            Questão <span id="questionNumber">1</span> de 11
                                        </div>
                                    </div>
                                    
                                    <div class="question-container">
                                        <div class="card question-card mb-4">
                                            <div class="card-body">
                                                <h5 class="card-text fw-bold" id="questionText"></h5>
                                            </div>
                                        </div>
                                        <div class="row g-3 alternatives-grid" id="alternatives" style="grid-template-columns: 1fr 1fr;"></div>
                                    </div>
                                </div>

                                <!-- Player Waiting for Results -->
                                <div id="playerWaitingResults" class="d-none">
                                    <div class="text-center waiting">
                                        <i class="bi bi-check-circle icon-lg mb-3 text-success"></i>
                                        <h2 class="mb-4">Você completou o quiz!</h2>
                                        <div class="score mb-4" id="finalScore">Sua pontuação final: 0 pontos</div>
                                        <div class="spinner-border text-light mb-3" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p>Esperando todos os jogadores finalizarem...</p>
                                    </div>
                                </div>

                                <!-- Player Final Results -->
                                <div id="playerResults" class="d-none">
                                    <div class="text-center mb-4">
                                        <i class="bi bi-award icon-lg mb-3"></i>
                                        <h2 class="mb-4">Resultados Finais</h2>
                                        <div class="score mb-2" id="playerFinalScore">Sua pontuação: 0 pontos</div>
                                        <div class="score mb-4" id="playerPosition">Sua posição: #1</div>
                                    </div>
                                    <div class="custom-scrollbar" id="finalLeaderboard"></div>
                                </div>
                            </div>

                            <!-- Host System -->
                            <div id="hostSystem" class="d-none">
                                <!-- Host Lobby Setup -->
                                <div id="hostLobby">
                                    <div class="text-center mb-4">
                                        <i class="bi bi-gear icon-lg mb-3"></i>
                                        <h2 class="mb-4">Quiz - Área do Organizador</h2>
                                        <div id="roomCodeDisplay" class="d-none">
                                            <p>Código da Sala: <span id="roomCode" class="text-white fw-bold"></span></p>
                                        </div>
                                    </div>
                                    <div class="d-grid">
                                        <button class="btn btn-purple btn-lg mb-4" onclick="openLobby()" id="openLobbyBtn">
                                            <i class="bi bi-door-open me-2"></i>Abrir sala
                                        </button>
                                    </div>
                                    
                                    <div id="lobbyOpen" class="d-none">
                                        <h4 class="mb-3"><i class="bi bi-people me-2"></i>Jogadores na Sala: <span id="playerCount">0</span></h4>
                                        <div class="card glass-effect mb-3">
                                            <div class="card-body player-header py-2">
                                                <div class="row">
                                                    <div class="col-6">
                                                        <strong>Nome</strong>
                                                    </div>
                                                    <div class="col-6 text-end">
                                                        <strong>Escola - Cidade</strong>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="custom-scrollbar mb-4" id="playersList"></div>
                                        <div class="d-grid">
                                            <button class="btn btn-purple btn-lg" onclick="startGame()" id="startGameBtn" disabled>
                                                <i class="bi bi-play-circle me-2"></i>Começar o jogo
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Host Game View -->
                                <div id="hostGame" class="d-none">
                                    <div class="text-center mb-4">
                                        <h2 class="mb-3"><i class="bi bi-trophy me-2"></i>Classificação Geral</h2>
                                        <div class="timer mb-3" id="gameTimer">5:00</div>
                                    </div>
                                    <div class="custom-scrollbar" id="liveLeaderboard"></div>
                                </div>

                                <!-- Host Final Results -->
                                <div id="hostResults" class="d-none">
                                    <div class="text-center mb-4">
                                        <i class="bi bi-trophy-fill icon-lg mb-3 text-warning"></i>
                                        <h2 class="mb-4">Resultados do Quiz - Top 3</h2>
                                    </div>
                                    <div class="mb-4" id="top3Leaderboard"></div>
                                    <div class="d-grid">
                                        <button class="btn btn-purple btn-lg" onclick="restartGame()">
                                            <i class="bi bi-arrow-clockwise me-2"></i>Reiniciar o jogo
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <script>
        // WebSocket Connection
        let ws = null;
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 5;
        let isLocalMode = false;

        // Game State
        let gameState = {
            isHost: false,
            players: [],
            currentPlayer: null,
            gameStarted: false,
            gameEnded: false,
            currentQuestion: 0,
            gameTimer: 300, // 5 minutes
            roomCode: null,
            questions: [
                {
                    question: "Qual destes dispositivos é considerado um hardware?",
                    alternatives: ["Navegador de internet", "Mouse", "Sistema operacional", "Aplicativo de mensagens"],
                    correct: 1
                },
                {
                    question: "Qual destas tecnologias utilizamos para navegar em sites na internet?",
                    alternatives: ["Bluetooth", "Impressora", "Navegador (browser)", "Caixa de som"],
                    correct: 2
                },
                {
                    question: "A sigla abreviada WWW significa?",
                    alternatives: ["World Wide Web", "Wireless Wide Web", "Web World Window", "Wide Web World"],
                    correct: 0
                },
                {
                    question: "No curso de Desenvolvimentos de Sistemas, você aprenderá?",
                    alternatives: ["Lógica de Programação", "Criar Sites", "Fazer Aplicativos", "Todas as Alternativas"],
                    correct: 3
                },
                {
                    question: "Quando você baixa um aplicativo no celular, você está baixando um:",
                    alternatives: ["Hardware", "Software", "Periférico", "Teclado"],
                    correct: 1
                },
                {
                    question: 'O que significa o termo "nuvem" (cloud) na computação?',
                    alternatives: ["Um desenho no céu", "Um local na internet para armazenar arquivos e dados", "Um tipo de cabo", "Uma marca de computador"],
                    correct: 1
                },
                {
                    question: 'O que significa o termo "back-end"?',
                    alternatives: ["Parte visual onde o usuário interage", "Camada do sistema que lida com regras de negócio e acesso a dados", "Nome de um periférico do computador", "Processo de instalação de um programa"],
                    correct: 1
                },
                {
                    question: "Em redes de computadores, qual dispositivo conecta vários aparelhos dentro de uma mesma rede local (LAN)?",
                    alternatives: ["Switch", "Pendrive", "Impressora", "Webcam"],
                    correct: 0
                },
                {
                    question: "Em um site, qual tecnologia é responsável por definir o estilo (cores, fontes, tamanhos) das páginas?",
                    alternatives: ["HTML", "CSS", "SQL", "BIOS"],
                    correct: 1
                },
                {
                    question: "Em um site, qual tecnologia é responsável por tornar as páginas dinâmicas, reagindo às ações do usuário?",
                    alternatives: ["HTML", "CSS", "JavaScript", "SQL"],
                    correct: 2
                },
                {
                    question: "Você irá prestar Desenvolvimento de Sistemas?",
                    alternatives: ["Sim", "Claro", "Com certeza", "Todas as Alternativas"],
                    correct: 3
                }
            ]
        };

        // Home Screen Functions
        function startQuiz() {
            const homeScreen = document.getElementById('homeScreen');
            const mainContent = document.getElementById('mainContent');
          
            // Hide home screen after animation starts
            setTimeout(() => {
                homeScreen.classList.add('fade-out');
            }, 200);

            // Show main content after TV animation completes
            setTimeout(() => {
                homeScreen.style.display = 'none';
                mainContent.classList.add('show');
            }, 1500);
        }

        function showCredits() {
            alert('Quiz desenvolvido para o curso de Desenvolvimento de Sistemas do COTIL - Unicamp\n\nDesenvolvido com ❤️ para testar seus conhecimentos sobre tecnologia!');
        }

        function goBackHome() {
            const homeScreen = document.getElementById('homeScreen');
            const mainContent = document.getElementById('mainContent');
            const systemSelector = document.getElementById('systemSelector');
            const playerSystem = document.getElementById('playerSystem');
            const hostSystem = document.getElementById('hostSystem');

            // Reset all views
            systemSelector.classList.remove('d-none');
            playerSystem.classList.add('d-none');
            hostSystem.classList.add('d-none');

            // Reset game state
            gameState.isHost = false;
            gameState.players = [];
            gameState.currentPlayer = null;
            gameState.gameStarted = false;
            gameState.gameEnded = false;
            gameState.currentQuestion = 0;
            gameState.gameTimer = 300;

            setTimeout(() => {
                mainContent.classList.add('fade-out');
            }, 200);
            mainContent.classList.remove('show')
            // Show main content after TV animation completes
            setTimeout(() => {
                homeScreen.style.display = 'flex';
                homeScreen.classList.remove('fade-out');
            }, 1500);
        }

        // WebSocket Functions
        function connectWebSocket() {
            try {
                // Replace with your WebSocket server URL
                ws = new WebSocket('wss://loving-generosity-production.up.railway.app');
                
                ws.onopen = function() {
                    console.log('Connected to WebSocket server');
                    reconnectAttempts = 0;
                    isLocalMode = false;
                    updateConnectionStatus('Connected', 'success');
                };

                ws.onmessage = function(event) {
                    const message = JSON.parse(event.data);
                    handleWebSocketMessage(message);
                };

                ws.onclose = function() {
                    console.log('Disconnected from WebSocket server');
                    updateConnectionStatus('Disconnected', 'warning');
                    attemptReconnect();
                };

                ws.onerror = function(error) {
                    console.error('WebSocket error:', error);
                    updateConnectionStatus('Connection Error', 'danger');
                };
            } catch (error) {
                console.error('Failed to connect to WebSocket:', error);
                enableLocalMode();
            }
        }

        function attemptReconnect() {
            if (reconnectAttempts < maxReconnectAttempts) {
                reconnectAttempts++;
                updateConnectionStatus(`Reconnecting... (${reconnectAttempts}/${maxReconnectAttempts})`, 'warning');
                setTimeout(() => {
                    console.log(`Reconnection attempt ${reconnectAttempts}`);
                    connectWebSocket();
                }, 2000 * reconnectAttempts);
            } else {
                enableLocalMode();
            }
        }

        function enableLocalMode() {
            isLocalMode = true;
            updateConnectionStatus('Local Mode', 'secondary');
            console.log('Running in local mode - WebSocket features disabled');
        }

        function updateConnectionStatus(status, type = 'secondary') {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.textContent = status;
            statusElement.className = `badge bg-${type}`;
        }

        function sendWebSocketMessage(message) {
            if (ws && ws.readyState === WebSocket.OPEN && !isLocalMode) {
                ws.send(JSON.stringify(message));
                return true;
            } else {
                console.warn('WebSocket not connected, message not sent:', message);
                // Handle local mode operations
                handleLocalModeMessage(message);
                return false;
            }
        }

        function handleLocalModeMessage(message) {
            // Simulate server responses for local testing
            switch (message.type) {
                case 'create_room':
                    gameState.roomCode = 'LOCAL-' + Math.random().toString(36).substr(2, 5).toUpperCase();
                    updateRoomCode();
                    break;
                
                case 'join_game':
                    // Add player to local list
                    const existingPlayerIndex = gameState.players.findIndex(p => p.id === message.player.id);
                    if (existingPlayerIndex === -1) {
                        gameState.players.push(message.player);
                        if (gameState.isHost) {
                            updateHostPlayersList();
                        }
                    }
                    break;
            }
        }

        function handleWebSocketMessage(message) {
            switch (message.type) {
                case 'room_created':
                    gameState.roomCode = message.roomCode;
                    updateRoomCode();
                    break;
                
                case 'player_joined':
                    if (gameState.isHost) {
                        gameState.players = message.players || [];
                        updateHostPlayersList();
                    }
                    break;
                
                case 'players_list_update':
                    if (gameState.isHost) {
                        gameState.players = message.players || [];
                        updateHostPlayersList();
                    }
                    break;
                
                case 'game_started':
                    if (!gameState.isHost) {
                        startPlayerQuiz();
                    }
                    break;
                
                case 'leaderboard_update':
                    if (gameState.isHost) {
                        gameState.players = message.players || [];
                        updateHostLeaderboard();
                    }
                    break;
                
                case 'game_ended':
                    endGameFromServer(message.finalResults);
                    break;
                
                case 'timer_update':
                    if (gameState.isHost) {
                        gameState.gameTimer = message.timeLeft;
                        updateTimerDisplay();
                    }
                    break;
                
                case 'error':
                    alert(message.message);
                    break;
            }
        }

        // System Initialization
        function initHost() {
            gameState.isHost = true;
            // Initialize empty players array
            gameState.players = [];
            
            document.getElementById('systemSelector').classList.add('d-none');
            document.getElementById('hostSystem').classList.remove('d-none');
            
            // Request room creation from server
            sendWebSocketMessage({
                type: 'create_room'
            });
        }

        function initPlayer() {
            gameState.isHost = false;
            document.getElementById('systemSelector').classList.add('d-none');
            document.getElementById('playerSystem').classList.remove('d-none');
        }

        // Player Functions
        function joinGame() {
            const name = document.getElementById('playerName').value.trim();
            const school = document.getElementById('playerSchool').value.trim();
            const city = document.getElementById('playerCity').value.trim();

            if (!name || !school || !city) {
                alert('Por favor, preencha todos os campos!');
                return;
            }

            gameState.currentPlayer = {
                id: Date.now() + Math.random(), // Ensure unique ID
                name: name,
                school: school,
                city: city,
                score: 0,
                answeredQuestions: 0,
                finished: false
            };

            // Send join request to server
            const messageSent = sendWebSocketMessage({
                type: 'join_game',
                player: gameState.currentPlayer,
                roomCode: gameState.roomCode
            });

            // If in local mode, add player directly
            if (isLocalMode || !messageSent) {
                const existingPlayerIndex = gameState.players.findIndex(p => p.id === gameState.currentPlayer.id);
                if (existingPlayerIndex === -1) {
                    gameState.players.push(gameState.currentPlayer);
                }
            }

            document.getElementById('playerRegistration').classList.add('d-none');
            document.getElementById('playerWaiting').classList.remove('d-none');
        }

        function startPlayerQuiz() {
            document.getElementById('playerWaiting').classList.add('d-none');
            document.getElementById('playerQuiz').classList.remove('d-none');
            showQuestion();
        }

        function showQuestion() {
            if (gameState.currentQuestion >= gameState.questions.length) {
                finishPlayerQuiz();
                return;
            }

            const question = gameState.questions[gameState.currentQuestion];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionNumber').textContent = gameState.currentQuestion + 1;

            const alternativesContainer = document.getElementById('alternatives');
            alternativesContainer.innerHTML = '';

            question.alternatives.forEach((alt, index) => {
                const colDiv = document.createElement('div');
                colDiv.className = 'col-12 col-md-6';
                
                const altBtn = document.createElement('button');
                altBtn.className = 'btn alternative-btn w-100 h-100';
                altBtn.textContent = alt;
                altBtn.onclick = () => selectAnswer(index);
                
                colDiv.appendChild(altBtn);
                alternativesContainer.appendChild(colDiv);
            });
        }

        function selectAnswer(selectedIndex) {
            const question = gameState.questions[gameState.currentQuestion];
            const alternatives = document.querySelectorAll('.alternative-btn');
            
            // Disable all alternatives
            alternatives.forEach(alt => alt.onclick = null);

            const isCorrect = selectedIndex === question.correct;
            
            if (isCorrect) {
                alternatives[selectedIndex].classList.add('correct');
                gameState.currentPlayer.score += 10;
                updatePlayerScore();
            } else {
                alternatives[selectedIndex].classList.add('wrong');
                alternatives[question.correct].classList.add('show-correct');
            }

            gameState.currentPlayer.answeredQuestions++;
            gameState.currentQuestion++;

            // Send answer to server
            sendWebSocketMessage({
                type: 'answer_submitted',
                playerId: gameState.currentPlayer.id,
                questionIndex: gameState.currentQuestion - 1,
                selectedAnswer: selectedIndex,
                isCorrect: isCorrect,
                newScore: gameState.currentPlayer.score
            });

            setTimeout(() => {
                showQuestion();
            }, 2000);
        }

        function updatePlayerScore() {
            document.getElementById('playerScore').innerHTML = `<i class="bi bi-trophy me-2"></i>Pontuação: ${gameState.currentPlayer.score} pontos`;
        }

        function finishPlayerQuiz() {
            gameState.currentPlayer.finished = true;
            document.getElementById('playerQuiz').classList.add('d-none');
            document.getElementById('playerWaitingResults').classList.remove('d-none');
            document.getElementById('finalScore').textContent = `Sua pontuação final: ${gameState.currentPlayer.score} pontos`;

            // Notify server that player finished
            sendWebSocketMessage({
                type: 'player_finished',
                playerId: gameState.currentPlayer.id,
                finalScore: gameState.currentPlayer.score
            });
        }

        // Host Functions
        function openLobby() {
            document.getElementById('openLobbyBtn').classList.add('d-none');
            document.getElementById('lobbyOpen').classList.remove('d-none');
            
            // Initialize players list immediately
            updateHostPlayersList();
            
            // Start polling for players if in local mode
            if (isLocalMode) {
                startLocalModePolling();
            }
        }

        function startLocalModePolling() {
            // For demonstration purposes, add some sample players in local mode
            setTimeout(() => {
                if (isLocalMode && gameState.isHost) {
                    // Add a sample player for testing
                    const samplePlayer = {
                        id: Date.now(),
                        name: "Jogador Teste",
                        school: "COTIL",
                        city: "Limeira",
                        score: 0,
                        answeredQuestions: 0,
                        finished: false
                    };
                    
                    const existingPlayer = gameState.players.find(p => p.name === samplePlayer.name);
                    if (!existingPlayer) {
                        gameState.players.push(samplePlayer);
                        updateHostPlayersList();
                    }
                }
            }, 2000);
        }

        function updateHostPlayersList() {
            const playersList = document.getElementById('playersList');
            const playerCount = document.getElementById('playerCount');
            
            // Clear the list
            playersList.innerHTML = '';
            
            // Update player count
            playerCount.textContent = gameState.players.length;

            // Add each player to the list
            gameState.players.forEach((player, index) => {
                const playerCard = document.createElement('div');
                playerCard.className = 'card player-item mb-2';
                playerCard.innerHTML = `
                    <div class="card-body py-2">
                        <div class="row align-items-center">
                            <div class="col-6">
                                <span class="text-white">${player.name}</span>
                            </div>
                            <div class="col-6 text-end">
                                <span class="text-white">${player.school} - ${player.city}</span>
                            </div>
                        </div>
                    </div>
                `;
                playersList.appendChild(playerCard);
            });

            // Update start button state
            const startBtn = document.getElementById('startGameBtn');
            startBtn.disabled = gameState.players.length === 0;
            
            console.log(`Updated players list: ${gameState.players.length} players`);
        }

        function startGame() {
            if (gameState.players.length === 0) {
                alert('Aguarde pelo menos um jogador entrar na sala!');
                return;
            }

            gameState.gameStarted = true;
            document.getElementById('hostLobby').classList.add('d-none');
            document.getElementById('hostGame').classList.remove('d-none');

            // Send start game message to server
            sendWebSocketMessage({
                type: 'start_game'
            });

            // Start game timer
            startGameTimer();
            updateHostLeaderboard();
        }

        function startGameTimer() {
            const timerInterval = setInterval(() => {
                gameState.gameTimer--;
                updateTimerDisplay();
                
                if (gameState.gameTimer <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerElement = document.getElementById('gameTimer');
            const minutes = Math.floor(gameState.gameTimer / 60);
            const seconds = gameState.gameTimer % 60;
            timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateHostLeaderboard() {
            const leaderboard = document.getElementById('liveLeaderboard');
            const sortedPlayers = [...gameState.players].sort((a, b) => b.score - a.score);
            
            leaderboard.innerHTML = '';
            sortedPlayers.forEach((player, index) => {
                const playerCard = document.createElement('div');
                playerCard.className = 'leaderboard-item mb-3';
                playerCard.innerHTML = `
                    <div class="card-body py-3">
                        <div class="row align-items-center">
                            <div class="col-1">
                                <span class="badge bg-secondary fs-6">#${index + 1}</span>
                            </div>
                            <div class="col-7">
                                <strong>${player.name}</strong>
                                <br><small>${player.school}</small>
                            </div>
                            <div class="col-4 text-end">
                                <span class="badge badge-purple fs-6">${player.score} pontos</span>
                            </div>
                        </div>
                    </div>
                `;
                leaderboard.appendChild(playerCard);
            });
        }

        function checkAllPlayersFinished() {
            const allFinished = gameState.players.every(player => player.finished);
            if (allFinished) {
                setTimeout(() => {
                    endGame();
                }, 2000);
            }
        }

        function endGameFromServer(finalResults) {
            gameState.gameEnded = true;
            if (finalResults && finalResults.players) {
                gameState.players = finalResults.players;
            }
            
            // Show host results
            if (gameState.isHost) {
                showHostResults();
            }
            
            // Show player results
            showPlayerResults();
        }

        function endGame() {
            gameState.gameEnded = true;
            
            // Show host results
            if (gameState.isHost || !document.getElementById('hostGame').classList.contains('d-none')) {
                showHostResults();
            }
            
            // Show player results
            showPlayerResults();
        }

        function showHostResults() {
            document.getElementById('hostGame').classList.add('d-none');
            document.getElementById('hostResults').classList.remove('d-none');
            
            const top3Players = [...gameState.players]
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);
            
            const top3Leaderboard = document.getElementById('top3Leaderboard');
            top3Leaderboard.innerHTML = '';
            
            top3Players.forEach((player, index) => {
                const playerCard = document.createElement('div');
                playerCard.className = `leaderboard-item mb-3 ${index === 0 ? 'top' : ''}`;
                playerCard.innerHTML = `
                    <div class="card-body py-3">
                        <div class="row align-items-center">
                            <div class="col-2">
                                ${index === 0 ? '<i class="bi bi-trophy-fill text-warning fs-3"></i>' : 
                                  index === 1 ? '<i class="bi bi-award-fill text-secondary fs-3"></i>' : 
                                  '<i class="bi bi-award text-warning fs-3"></i>'}
                            </div>
                            <div class="col-6">
                                <strong>#${index + 1} ${player.name}</strong>
                                <br><small>${player.school}</small>
                            </div>
                            <div class="col-4 text-end">
                                <span class="badge badge-purple fs-5">${player.score} pontos</span>
                            </div>
                        </div>
                    </div>
                `;
                top3Leaderboard.appendChild(playerCard);
            });
        }

        function showPlayerResults() {
            if (gameState.currentPlayer) {
                document.getElementById('playerWaitingResults').classList.add('d-none');
                document.getElementById('playerResults').classList.remove('d-none');
                
                const sortedPlayers = [...gameState.players].sort((a, b) => b.score - a.score);
                const playerPosition = sortedPlayers.findIndex(p => p.id === gameState.currentPlayer.id) + 1;
                
                document.getElementById('playerFinalScore').textContent = `Sua pontuação: ${gameState.currentPlayer.score} pontos`;
                document.getElementById('playerPosition').textContent = `Sua posição: #${playerPosition}`;
                
                const finalLeaderboard = document.getElementById('finalLeaderboard');
                finalLeaderboard.innerHTML = '';
                
                sortedPlayers.forEach((player, index) => {
                    const playerCard = document.createElement('div');
                    playerCard.className = `leaderboard-item mb-2 ${player.id === gameState.currentPlayer.id ? 'top' : ''}`;
                    playerCard.innerHTML = `
                        <div class="card-body py-2">
                            <div class="row align-items-center">
                                <div class="col-2">
                                    <span class="badge bg-secondary">#${index + 1}</span>
                                </div>
                                <div class="col-6">
                                    <strong>${player.name}</strong>
                                    ${player.id === gameState.currentPlayer.id ? '<i class="bi bi-person-fill text-warning ms-1"></i>' : ''}
                                </div>
                                <div class="col-4 text-end">
                                    <span class="badge badge-purple">${player.score} pontos</span>
                                </div>
                            </div>
                        </div>
                    `;
                    finalLeaderboard.appendChild(playerCard);
                });
            }
        }

        function restartGame() {
            // Send restart message to server
            sendWebSocketMessage({
                type: 'restart_game'
            });

            // Reset local game state
            gameState.players = [];
            gameState.currentPlayer = null;
            gameState.gameStarted = false;
            gameState.gameEnded = false;
            gameState.currentQuestion = 0;
            gameState.gameTimer = 300;
            
            // Reset UI
            document.getElementById('hostResults').classList.add('d-none');
            document.getElementById('hostLobby').classList.remove('d-none');
            document.getElementById('openLobbyBtn').classList.remove('d-none');
            document.getElementById('lobbyOpen').classList.add('d-none');
            
            // Reset player UI
            document.getElementById('playerResults').classList.add('d-none');
            document.getElementById('playerRegistration').classList.remove('d-none');
            document.getElementById('playerName').value = '';
            document.getElementById('playerSchool').value = '';
            document.getElementById('playerCity').value = '';
        }

        function updateRoomCode() {
            if (gameState.roomCode) {
                document.getElementById('roomCodeDisplay').classList.remove('d-none');
                document.getElementById('roomCode').textContent = gameState.roomCode;
            }
            console.log('Room code:', gameState.roomCode);
        }

        // Initialize WebSocket connection and set up responsive behavior
        window.addEventListener('load', function() {
            connectWebSocket();
            
            // Add responsive grid behavior for alternatives
            function updateAlternativesGrid() {
                const alternatives = document.getElementById('alternatives');
                if (alternatives && window.innerWidth < 768) {
                    alternatives.style.gridTemplateColumns = '1fr';
                } else if (alternatives) {
                    alternatives.style.gridTemplateColumns = '1fr 1fr';
                }
            }
            
            // Update on resize
            window.addEventListener('resize', updateAlternativesGrid);
            updateAlternativesGrid();
        });
    </script>
</body>
</html>